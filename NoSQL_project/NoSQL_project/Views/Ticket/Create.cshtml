@using NoSQL_project.Enum
@model NoSQL_project.Models.Ticket

@{
    ViewData["Title"] = "New Ticket";
    var isServiceDesk = (bool)(ViewBag.IsServiceDesk ?? false);
    var users = ViewBag.Users as List<NoSQL_project.Models.User>;
    var currentUserId = ViewBag.CurrentUserId as string;
}

<h2>New Ticket</h2>

<div asp-validation-summary="All" class="text-danger"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<form asp-action="Create" method="post">
    @Html.AntiForgeryToken()

    @if (isServiceDesk)
    {
        <div class="mb-3">
            <label asp-for="UserId" class="form-label">Assign To User</label>
            <select asp-for="UserId" class="form-select">
                <option value="">-- Select User --</option>
                @foreach (var user in users)
                {
                    <option value="@user.Id">@user.FirstName @user.LastName (@user.Email)</option>
                }
            </select>
            <span asp-validation-for="UserId" class="text-danger"></span>
        </div>
    }
    else
    {
        <input type="hidden" asp-for="UserId" value="@currentUserId" />
    }

    <div class="mb-3">
        <label asp-for="IncidentSubject" class="form-label">Subject</label>
        <input asp-for="IncidentSubject" class="form-control" />
        <span asp-validation-for="IncidentSubject" class="text-danger"></span>
    </div>

   <div class="mb-3">
        <label asp-for="IncidentType" class="form-label">Type</label>
        <select asp-for="IncidentType"
                class="form-select"
                asp-items="Html.GetEnumSelectList<TicketIncidentType>()">
        </select>
    </div>

    <div class="mb-3">
        <label asp-for="Priority" class="form-label">Priority</label>
        <select asp-for="Priority"
                class="form-select"
                asp-items="Html.GetEnumSelectList<TicketPrioritys>()">
        </select>
    </div>

    <div class="mb-3">
        <label asp-for="status" class="form-label">Status</label>
        <select asp-for="status"
                class="form-select"
                asp-items="Html.GetEnumSelectList<TicketStatus>()">
        </select>
    </div>

    <div class="mb-3">
        <label asp-for="Date" class="form-label">Date</label>
        <input asp-for="Date"
               class="form-control"
               type="datetime-local"
               value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" />
        <span asp-validation-for="Date" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Deadline" class="form-label">Deadline</label>
        <input asp-for="Deadline" class="form-control" type="datetime-local" />
        <span asp-validation-for="Deadline" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Description" class="form-label">Description</label>
        <textarea asp-for="Description" class="form-control"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <button class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Create New Ticket
    </button>
    <a asp-controller="Ticket" asp-action="Index" class="btn btn-secondary">Cancel</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
